<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trendora Dashboard</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico" />

  <!-- Tailwind config (enable class-based dark mode) -->
  <script>
    window.tailwind = window.tailwind || {};
    window.tailwind.config = {
      darkMode: 'class',
      theme: { extend: {} }
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root { --trans: 250ms; }
    html { transition: background-color var(--trans), color var(--trans); }
    .dropdown-enter { transform: translateY(-6px); opacity: 0; }
    .dropdown-enter-active { transform: translateY(0); opacity: 1; transition: all 160ms ease-out; }
    .dropdown-leave { transform: translateY(0); opacity: 1; }
    .dropdown-leave-active { transform: translateY(-6px); opacity: 0; transition: all 120ms ease-in; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-100">

  <!-- Sidebar + Header Wrapper -->
  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-white dark:bg-gray-800 shadow-md flex flex-col">
      <div class="p-6 flex flex-col items-center border-b border-gray-200 dark:border-gray-700">
        <img src="assets/logo.png" alt="Trendora Logo" class="h-12 mb-3">
        <h1 class="text-xl font-bold text-blue-600 dark:text-blue-400">Trendora AI</h1>
        <span id="user-badge" class="text-xs text-gray-500 dark:text-gray-400 mt-1">Free member</span>
      </div>
      <nav class="mt-6 flex-1 space-y-2 px-4">
        <a href="dashboard.html" class="flex items-center gap-3 text-blue-600 font-semibold hover:bg-blue-50 dark:hover:bg-gray-700 p-2 rounded-md">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 12l2-2 7-7 7 7M12 5v14"></path></svg>
          Dashboard
        </a>
        <a href="products.html" class="flex items-center gap-3 text-gray-700 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700 p-2 rounded-md">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20 13V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v6m16 0v6a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-6m16 0H4"></path></svg>
          Products
        </a>
        <a href="#" class="flex items-center gap-3 text-gray-700 hover:text-blue-600 dark:text-gray-300 p-2 rounded-md">ğŸ“Š Sales Tracker</a>
        <a href="#" class="flex items-center gap-3 text-gray-700 hover:text-blue-600 dark:text-gray-300 p-2 rounded-md">ğŸ” Competitor Research</a>
        <a href="#" class="flex items-center gap-3 text-gray-700 hover:text-blue-600 dark:text-gray-300 p-2 rounded-md">ğŸ“¦ Product Database</a>
        <a href="#" class="flex items-center gap-3 text-gray-700 hover:text-blue-600 dark:text-gray-300 p-2 rounded-md">ğŸ­ Suppliers</a>
        <a href="#" class="flex items-center gap-3 text-gray-700 hover:text-blue-600 dark:text-gray-300 p-2 rounded-md">ğŸ¯ Create Ads</a>
        <a href="#" class="flex items-center gap-3 text-gray-700 hover:text-blue-600 dark:text-gray-300 p-2 rounded-md">ğŸ“ Portfolio</a>
        <a href="login.html" class="flex items-center gap-3 text-red-500 hover:bg-red-50 p-2 rounded-md mt-10">ğŸšª Logout</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8">
      <!-- Header Bar -->
      <div class="flex justify-between items-center mb-6 sticky top-0 bg-gray-100 dark:bg-gray-900 py-2 z-10 rounded">
        <h2 class="text-3xl font-bold">Dashboard</h2>
        <div class="flex space-x-4 items-center">

          <!-- Dark Mode Toggle -->
          <button id="theme-toggle" aria-label="Toggle theme" class="p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-800 transition">
            <span id="theme-icon" class="text-xl">ğŸŒ™</span>
          </button>

          <!-- Notifications -->
          <div class="relative" id="notifications-root">
            <button id="notif-btn" class="relative p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-800 transition" aria-expanded="false" aria-haspopup="true">
              <span class="text-xl">ğŸ””</span>
              <span id="notif-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full text-[11px] hidden">0</span>
            </button>

            <!-- Dropdown -->
            <div id="notif-dropdown" class="hidden absolute right-0 mt-2 w-96 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg overflow-hidden z-50 transform origin-top-right">
              <div class="flex items-center justify-between p-3 border-b border-gray-100 dark:border-gray-700">
                <strong class="text-sm">Notifications</strong>
                <div class="flex items-center gap-2">
                  <button id="mark-read" class="text-xs px-2 py-1 rounded bg-blue-50 dark:bg-gray-700 text-blue-600 hover:opacity-90">Mark all read</button>
                  <button id="clear-all" class="text-xs px-2 py-1 rounded bg-red-50 dark:bg-red-800 text-red-600 hover:opacity-90">Clear</button>
                </div>
              </div>
              <div id="notif-list" class="max-h-64 overflow-y-auto">
                <div class="p-4 text-sm text-gray-500 dark:text-gray-300">No notifications</div>
              </div>
              <div class="p-3 border-t text-center border-gray-100 dark:border-gray-700">
                <a href="#" class="text-xs text-blue-600 dark:text-blue-400 hover:underline">View all notifications</a>
              </div>
            </div>
          </div>

          <!-- User Profile -->
          <div class="flex items-center gap-3">
            <img src="assets/user.jpg" class="h-9 w-9 rounded-full border-2 border-blue-500" alt="User" />
          </div>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white p-6 rounded-xl shadow hover:scale-105 transition">
          <h4 class="text-sm">Total Sales</h4>
          <p class="text-2xl font-bold mt-2">$12,450</p>
          <p class="text-xs opacity-80">+12% from last week</p>
        </div>
        <div class="bg-gradient-to-r from-green-400 to-emerald-500 text-white p-6 rounded-xl shadow hover:scale-105 transition">
          <h4 class="text-sm">Active Products</h4>
          <p class="text-2xl font-bold mt-2">340</p>
          <p class="text-xs opacity-80">+45 new this week</p>
        </div>
        <div class="bg-gradient-to-r from-pink-500 to-rose-500 text-white p-6 rounded-xl shadow hover:scale-105 transition">
          <h4 class="text-sm">New Users</h4>
          <p class="text-2xl font-bold mt-2">1,200</p>
          <p class="text-xs opacity-80">+200 this week</p>
        </div>
      </div>

      <!-- Product Search -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-8">
        <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">ğŸ” Search for a Product</h3>
        <input id="product-search" type="text" placeholder="Type product name..." class="w-full border border-gray-300 dark:border-gray-700 rounded px-4 py-2 focus:outline-none focus:border-blue-500 dark:bg-gray-900" />
      </div>

      <!-- Charts Section -->
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 mb-8">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow hover:shadow-lg transition">
          <h4 class="font-semibold mb-2">ğŸ“ˆ Sales Performance</h4>
          <canvas id="salesChart" height="180"></canvas>
        </div>
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow hover:shadow-lg transition">
          <h4 class="font-semibold mb-2">ğŸ“Š Top Categories</h4>
          <canvas id="categoryChart" height="180"></canvas>
        </div>
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow hover:shadow-lg transition">
          <h4 class="font-semibold mb-2">ğŸ“‰ Ad Engagement</h4>
          <canvas id="adChart" height="180"></canvas>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Escape text to avoid injection (sabse pehle define)
    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // Notifications & Dark Mode Logic
    const DEFAULT_NOTIFICATIONS = [
      { id: 'n1', title: 'Subscription: Pro activated', body: 'Your Pro plan started today.', time: '2h ago', read: false },
      { id: 'n2', title: 'New product match', body: 'A product matched your watchlist.', time: '6h ago', read: false },
      { id: 'n3', title: 'Ad created successfully', body: 'Your ad image has been generated.', time: '1d ago', read: true }
    ];

    const LS_KEY = 'trendora.notifications.v1';
    const THEME_KEY = 'trendora.theme';

    const saveNotifs = (arr) => localStorage.setItem(LS_KEY, JSON.stringify(arr));
    const loadNotifs = () => {
      try {
        return JSON.parse(localStorage.getItem(LS_KEY)) || DEFAULT_NOTIFICATIONS.slice();
      } catch { return DEFAULT_NOTIFICATIONS.slice(); }
    };

    function renderNotifications() {
      const listRoot = document.getElementById('notif-list');
      const badge = document.getElementById('notif-badge');
      let arr = loadNotifs();
      const unreadCount = arr.filter(n=>!n.read).length;

      if (unreadCount > 0) {
        badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
        badge.classList.remove('hidden');
      } else {
        badge.classList.add('hidden');
      }

      if (!arr.length) {
        listRoot.innerHTML = '<div class="p-4 text-sm text-gray-500 dark:text-gray-300">No notifications</div>';
        return;
      }

      listRoot.innerHTML = arr.map(n => `
        <div class="p-3 flex items-start gap-3 border-b last:border-b-0 border-gray-100 dark:border-gray-700 ${n.read ? 'opacity-70' : ''}">
          <div class="flex-shrink-0">
            <div class="h-9 w-9 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-600 dark:text-blue-300 font-semibold">${n.title.charAt(0)}</div>
          </div>
          <div class="flex-1">
            <div class="flex justify-between items-start gap-3">
              <div>
                <div class="text-sm font-semibold">${escapeHtml(n.title)}</div>
                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">${escapeHtml(n.body)}</div>
              </div>
              <div class="text-xs text-gray-400 dark:text-gray-500">${n.time}</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    document.getElementById('mark-read').addEventListener('click', () => {
      let arr = loadNotifs().map(n => ({ ...n, read: true }));
      saveNotifs(arr);
      renderNotifications();
    });

    document.getElementById('clear-all').addEventListener('click', () => {
      saveNotifs([]);
      renderNotifications();
    });

    const notifBtn = document.getElementById('notif-btn');
    const notifDropdown = document.getElementById('notif-dropdown');
    const notifsRoot = document.getElementById('notifications-root');

    function openDropdown() {
      notifDropdown.classList.remove('hidden');
      notifBtn.setAttribute('aria-expanded', 'true');
    }
    function closeDropdown() {
      notifDropdown.classList.add('hidden');
      notifBtn.setAttribute('aria-expanded', 'false');
    }

    notifBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      notifDropdown.classList.contains('hidden') ? openDropdown() : closeDropdown();
    });

    document.addEventListener('click', (e) => {
      if (!notifsRoot.contains(e.target)) closeDropdown();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeDropdown();
    });

    if (!localStorage.getItem(LS_KEY)) saveNotifs(DEFAULT_NOTIFICATIONS.slice());
    renderNotifications();

    // Theme Toggle
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');

    function applyTheme(theme) {
      const html = document.documentElement;
      if (theme === 'dark') {
        html.classList.add('dark');
        themeIcon.textContent = 'â˜€ï¸';
      } else {
        html.classList.remove('dark');
        themeIcon.textContent = 'ğŸŒ™';
      }
      localStorage.setItem(THEME_KEY, theme);
    }

    (function initTheme() {
      const saved = localStorage.getItem(THEME_KEY);
      if (saved) { applyTheme(saved); return; }
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      applyTheme(prefersDark ? 'dark' : 'light');
    })();

    themeToggle.addEventListener('click', () => {
      const current = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
      applyTheme(current === 'dark' ? 'light' : 'dark');
    });

    // Charts
    new Chart(document.getElementById('salesChart'), {
      type: 'line',
      data: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [{
          label: 'Sales ($)',
          data: [120, 190, 300, 250, 280, 320, 400],
          borderColor: '#3b82f6',
          backgroundColor: 'rgba(59, 130, 246, 0.08)',
          fill: true,
          tension: 0.4
        }]
      },
      options: { responsive: true, plugins: { legend: { display: false } } }
    });

    new Chart(document.getElementById('categoryChart'), {
      type: 'pie',
      data: {
        labels: ['Home', 'Fitness', 'Beauty', 'Electronics'],
        datasets: [{
          data: [35, 25, 20, 20],
          backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444']
        }]
      },
      options: { responsive: true }
    });

    new Chart(document.getElementById('adChart'), {
      type: 'bar',
      data: {
        labels: ['Facebook', 'TikTok', 'Instagram'],
        datasets: [{
          label: 'Clicks',
          data: [500, 300, 450],
          backgroundColor: ['#1877f2', '#000000', '#e1306c']
        }]
      },
      options: { responsive: true, plugins: { legend: { display: false } } }
    });

    notifBtn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        notifBtn.click();
      }
    });
  </script>
</body>
</html>
