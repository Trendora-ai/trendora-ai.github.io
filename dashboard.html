<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trendora Dashboard</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico" />

  <!-- Tailwind config -->
  <script>
    window.tailwind = window.tailwind || {};
    window.tailwind.config = { darkMode: 'class', theme: { extend: {} } };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root { --trans: 250ms; }
    html { transition: background-color var(--trans), color var(--trans); }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-100">

  <!-- Sidebar + Header Wrapper -->
  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-white dark:bg-gray-800 shadow-md flex flex-col">
      <div class="p-6 flex flex-col items-center border-b border-gray-200 dark:border-gray-700">
        <img src="assets/logo.png" alt="Trendora Logo" class="h-12 mb-3">
        <h1 class="text-xl font-bold text-blue-600 dark:text-blue-400">Trendora AI</h1>
        <span id="user-badge" class="text-xs text-gray-500 dark:text-gray-400 mt-1">Free member</span>
      </div>
      <nav class="mt-6 flex-1 space-y-2 px-4">
        <a href="dashboard.html" class="block text-blue-600 font-semibold">Dashboard</a>
        <a href="products.html" class="block hover:text-blue-600">Products</a>
        <a href="#" class="block hover:text-blue-600">ğŸ“Š Sales Tracker</a>
        <a href="#" class="block hover:text-blue-600">ğŸ” Competitor Research</a>
        <a href="#" class="block hover:text-blue-600">ğŸ“¦ Product Database</a>
        <a href="#" class="block hover:text-blue-600">ğŸ­ Suppliers</a>
        <a href="#" class="block hover:text-blue-600">ğŸ¯ Create Ads</a>
        <a href="#" class="block hover:text-blue-600">ğŸ“ Portfolio</a>
        <a href="login.html" class="block text-red-500 mt-10">Logout</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8">
      <!-- Header -->
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-3xl font-bold">Dashboard</h2>
        <div class="flex items-center gap-4">
          <!-- Dark Mode Toggle -->
          <button id="theme-toggle" class="p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">
            <span id="theme-icon">ğŸŒ™</span>
          </button>

          <!-- Notifications -->
          <div class="relative">
            <button id="notif-btn" class="relative p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">
              ğŸ””
              <span id="notif-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full hidden">0</span>
            </button>
            <div id="notif-dropdown" class="hidden absolute right-0 mt-2 w-96 bg-white dark:bg-gray-800 border rounded-xl shadow-lg z-50">
              <div class="flex justify-between items-center p-3 border-b">
                <strong>Notifications</strong>
                <div class="space-x-2">
                  <button id="mark-all-read" class="text-xs text-blue-500">Mark all read</button>
                  <button id="clear-all" class="text-xs text-red-500">Clear</button>
                </div>
              </div>
              <div id="notif-list" class="max-h-72 overflow-y-auto">
                <div class="p-3 text-sm text-gray-500">No notifications</div>
              </div>
            </div>
          </div>

          <!-- User -->
          <img src="assets/user.jpg" class="h-9 w-9 rounded-full border-2 border-blue-500" alt="User"/>
        </div>
      </div>

      <!-- Stats -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-blue-500 text-white p-6 rounded-xl shadow">
          <h4>Total Sales</h4>
          <p class="text-2xl font-bold mt-2">$12,450</p>
        </div>
        <div class="bg-green-500 text-white p-6 rounded-xl shadow">
          <h4>Active Products</h4>
          <p class="text-2xl font-bold mt-2">340</p>
        </div>
        <div class="bg-pink-500 text-white p-6 rounded-xl shadow">
          <h4>New Users</h4>
          <p class="text-2xl font-bold mt-2">1,200</p>
        </div>
      </div>

      <!-- Product Search -->
      <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow mb-8">
        <h3 class="text-xl mb-4">ğŸ” Search for a Product</h3>
        <input type="text" placeholder="Type product name..." class="w-full border rounded px-4 py-2"/>
      </div>

      <!-- Charts -->
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow">
          <h4>ğŸ“ˆ Sales Performance</h4>
          <canvas id="salesChart"></canvas>
        </div>
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow">
          <h4>ğŸ“Š Top Categories</h4>
          <canvas id="categoryChart"></canvas>
        </div>
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow">
          <h4>ğŸ“‰ Ad Engagement</h4>
          <canvas id="adChart"></canvas>
        </div>
      </div>
    </main>
  </div>

  <!-- Firestore + App Scripts -->
  <script type="module">
    // Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, onSnapshot, addDoc, deleteDoc, doc, updateDoc, serverTimestamp, query, orderBy, getDocs } 
      from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // ğŸ”‘ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyC7ehbN_SlpBz14zuZ4Etok31vdw1XmGOQ",
      authDomain: "trendora-auth.firebaseapp.com",
      projectId: "trendora-auth",
      storageBucket: "trendora-auth.firebasestorage.app",
      messagingSenderId: "169775124553",
      appId: "1:169775124553:web:0d06cccd6dd110c72aef98"
    };

    // Init
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Elements
    const notifBtn = document.getElementById("notif-btn");
    const notifDropdown = document.getElementById("notif-dropdown");
    const notifBadge = document.getElementById("notif-badge");
    const notifList = document.getElementById("notif-list");
    const clearAllBtn = document.getElementById("clear-all");
    const markAllReadBtn = document.getElementById("mark-all-read");

    // Realtime Firestore listener
    const q = query(collection(db, "Notifications"), orderBy("createdAt", "desc"));
    onSnapshot(q, (snapshot) => {
      notifList.innerHTML = "";
      let unreadCount = 0;

      snapshot.forEach((docSnap) => {
        const notif = docSnap.data();
        const id = docSnap.id;
        const read = notif.read || false;
        if (!read) unreadCount++;

        const item = document.createElement("div");
        item.className = "flex items-start gap-3 p-3 border-b last:border-0 cursor-pointer " + (read ? "text-gray-500" : "font-semibold");
        item.innerHTML = `
          <div class="flex-1">
            <p>${notif.title || "Notification"}</p>
            <p class="text-sm">${notif.message || ""}</p>
            <span class="text-xs text-gray-400">${notif.createdAt?.toDate ? notif.createdAt.toDate().toLocaleString() : ""}</span>
          </div>
        `;
        item.addEventListener("click", async () => {
          await updateDoc(doc(db, "Notifications", id), { read: true });
        });
        notifList.appendChild(item);
      });

      if (unreadCount > 0) {
        notifBadge.textContent = unreadCount;
        notifBadge.classList.remove("hidden");
      } else {
        notifBadge.classList.add("hidden");
      }

      if (snapshot.empty) {
        notifList.innerHTML = '<div class="p-3 text-sm text-gray-500">No notifications</div>';
      }
    });

    // Toggle dropdown
    notifBtn.addEventListener("click", () => {
      notifDropdown.classList.toggle("hidden");
    });

    // Clear all notifications
    clearAllBtn.addEventListener("click", async () => {
      const querySnapshot = await getDocs(collection(db, "Notifications"));
      querySnapshot.forEach(async (d) => {
        await deleteDoc(doc(db, "Notifications", d.id));
      });
    });

    // Mark all read
    markAllReadBtn.addEventListener("click", async () => {
      const querySnapshot = await getDocs(collection(db, "Notifications"));
      querySnapshot.forEach(async (d) => {
        await updateDoc(doc(db, "Notifications", d.id), { read: true });
      });
    });

    // --- Add Useful Notifications Once ---
    async function addTestNotifications() {
      const notifications = [
        {
          title: "Plan Expiry Alert",
          message: "Your free plan will expire in 3 days. Upgrade now to avoid interruption.",
          read: false,
          createdAt: serverTimestamp()
        },
        {
          title: "Pro Plan Activated ğŸ‰",
          message: "Congratulations! You have successfully upgraded to the Pro Plan.",
          read: false,
          createdAt: serverTimestamp()
        },
        {
          title: "Payment Failed âŒ",
          message: "Your last payment could not be processed. Please update your billing info.",
          read: false,
          createdAt: serverTimestamp()
        }
      ];

      for (const notif of notifications) {
        await addDoc(collection(db, "Notifications"), notif);
      }
      console.log("âœ… 3 notifications added successfully!");
    }

    // Run once (phir comment kar dena)
    // addTestNotifications();

    // --- Dark Mode ---
    const themeToggle = document.getElementById("theme-toggle");
    const themeIcon = document.getElementById("theme-icon");
    function applyTheme(dark) {
      if (dark) {
        document.documentElement.classList.add("dark");
        themeIcon.textContent = "â˜€ï¸";
      } else {
        document.documentElement.classList.remove("dark");
        themeIcon.textContent = "ğŸŒ™";
      }
    }
    themeToggle.addEventListener("click", () => {
      const isDark = document.documentElement.classList.contains("dark");
      applyTheme(!isDark);
    });

    // --- Charts ---
    new Chart(document.getElementById('salesChart'), {
      type: 'line',
      data: { labels: ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"], datasets: [{ data: [120,190,300,250,280,320,400], borderColor:"#3b82f6" }] },
      options: { responsive:true, plugins:{ legend:{display:false} } }
    });
    new Chart(document.getElementById('categoryChart'), {
      type: 'pie',
      data: { labels:["Home","Fitness","Beauty","Electronics"], datasets:[{ data:[35,25,20,20], backgroundColor:["#3b82f6","#10b981","#f59e0b","#ef4444"] }] },
      options: { responsive:true }
    });
    new Chart(document.getElementById('adChart'), {
      type: 'bar',
      data: { labels:["Facebook","TikTok","Instagram"], datasets:[{ data:[500,300,450], backgroundColor:["#1877f2","#000","#e1306c"] }] },
      options: { responsive:true, plugins:{ legend:{display:false} } }
    });
  </script>
</body>
  </html>
